#include <LovyanGFX.hpp>
#include <math.h>

class LGFX : public lgfx::LGFX_Device {
  lgfx::Panel_ST7796 _panel;
  lgfx::Bus_Parallel8 _bus;
  lgfx::Touch_FT5x06 _touch;

public:
  LGFX() {
    auto cfg = _bus.config();
    cfg.freq_write = 20000000;
    cfg.pin_wr = 47;
    cfg.pin_rs = 0;
    cfg.pin_d0 = 9; cfg.pin_d1 = 46; cfg.pin_d2 = 3; cfg.pin_d3 = 8; cfg.pin_d4 = 18; cfg.pin_d5 = 17; cfg.pin_d6 = 16; cfg.pin_d7 = 15;
    _bus.config(cfg);
    _panel.setBus(&_bus);

    auto panel_cfg = _panel.config();
    panel_cfg.pin_rst = 4;
    panel_cfg.panel_width = 320;
    panel_cfg.panel_height = 480;
    _panel.config(panel_cfg);
    setPanel(&_panel);

    auto touch_cfg = _touch.config();
    touch_cfg.i2c_port = 1;
    touch_cfg.pin_sda = 6;  
    touch_cfg.pin_scl = 5;  
    touch_cfg.pin_int = 7;  
    _touch.config(touch_cfg);
  }

  void initTouch() {_touch.init();}

  bool getTouch(int16_t* x, int16_t* y) {
    lgfx::v1::touch_point_t tp;
    bool touch = false;

    if (_touch.getTouchRaw(&tp, 1)){
      *x = 320-tp.x;
      *y = 480-tp.y;
      touch = true;
    }
    return touch;
  }
};

const int IMAGE_HEIGHT = 32;
const int IMAGE_WIDTH  = 80;
const uint16_t image_data[] = {
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x767e, 0x4d15, 0x6e7e, 0x769f, 0x76bf, 0x769f, 0x6e5d, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x65fb, 0x44b2, 0x661b, 0x65da, 0x6e3d, 0x65fb, 0x342f, 0x661c, 0x6e1c, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x65da, 0x33ed, 0x5d98, 0x3c91, 0x238a, 0x4491, 0x238a, 0x3c2f, 0x33ed, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x65fb, 0x3c4f, 0x5557, 0x3c91, 0x3c50, 0x44b2, 0x340e, 0x4491, 0x44b2, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x769f, 0x76bf, 0x76bf, 0x769f, 0x6e3c, 0x6e1c, 0x65da, 0x769f, 0x769f, 0x769f, 0x769f, 0x767e, 0x5d77, 0x769f, 0x769f, 0x6e3c, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x6e18, 0x65b3, 0x6e39, 0x769f, 0x769f, 0x6df7, 0x6591, 0x65d4, 0x767e, 0x76bf, 0x6e3c, 0x340e, 0x5536, 0x44d3, 0x44d3, 0x4cf4, 0x4d15, 0x4cf4, 0x4d14, 0x44b2, 0x4d15, 0x44d3, 0x4d15, 0x4d15, 0x5556, 0x5556, 0x5d78, 0x4cf4, 0x4cd3, 0x4cf4, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x6e17, 0x54a6, 0x54a6, 0x54a6, 0x6e39, 0x6df6, 0x54a6, 0x54a6, 0x54a6, 0x5d4e, 0x769f, 0x65da, 0x342f, 0x65d9, 0x4cf4, 0x238a, 0x4cf4, 0x236a, 0x4d15, 0x2369, 0x342f, 0x3c50, 0x4cf4, 0x342f, 0x2349, 0x3c70, 0x342f, 0x44d3, 0x340e, 0x5db9, 0x342e, 0x767e, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x5d0b, 0x54a6, 0x54a6, 0x54a6, 0x550a, 0x65b2, 0x54a6, 0x54a6, 0x54a6, 0x5d0b, 0x767d, 0x6e3c, 0x4cf4, 0x661b, 0x5db9, 0x4d14, 0x65da, 0x44b2, 0x342f, 0x4cf4, 0x5d98, 0x5d98, 0x65da, 0x5577, 0x4d35, 0x5dd9, 0x4d15, 0x5556, 0x5556, 0x6e3d, 0x5535, 0x767e, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x5d2d, 0x54a6, 0x54a6, 0x54a6, 0x5d2c, 0x65b2, 0x54a6, 0x54a6, 0x4ca6, 0x34cc, 0x6e5d, 0x769f, 0x769f, 0x769f, 0x76bf, 0x769f, 0x769f, 0x6e5d, 0x661b, 0x769f, 0x769f, 0x76bf, 0x76bf, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x76bf, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x769d, 0x769c, 0x767c, 0x769d, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769e, 0x769d, 0x7e9d, 0x7ebe, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x769f, 0x769e, 0x769f, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x765c, 0x5d0b, 0x54a6, 0x5d2c, 0x767d, 0x65b2, 0x54a6, 0x3c67, 0x0c07, 0x146b, 0x6e5d, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x7e9d, 0x7e9d, 0x7e9d, 0x7ebf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x769f, 0x7e59, 0x7ded, 0x7da8, 0x7da8, 0x7da8, 0x85a9, 0x7def, 0x7e7c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769d, 0x7e33, 0x85ca, 0x85a9, 0x9609, 0xae88, 0x9691, 0x7e9d, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x767d, 0x65b2, 0x54e9, 0x54e9, 0x54e9, 0x5d70, 0x6e5b, 0x769f, 0x76bf, 0x767d, 0x5d2c, 0x54a6, 0x5d4d, 0x769f, 0x65b3, 0x2c68, 0x03e7, 0x03e6, 0x146b, 0x6e5c, 0x767c, 0x6e38, 0x6e16, 0x6e59, 0x769d, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x8699, 0x9e6c, 0xa667, 0xa667, 0xa667, 0x9e6a, 0x8e95, 0x7ebe, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x767c, 0x7def, 0x85a7, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x85a8, 0x7e34, 0x769f, 0x76bf, 0x76bf, 0x769f, 0x7e57, 0x7dca, 0x8587, 0x8587, 0x8dc7, 0xb665, 0xb685, 0xb685, 0xae88, 0x8e96, 0x76bf, 0x76bf, 0x7ebe, 0x8e95, 0x6d48, 0x54a6, 0x54a6, 0x54a6, 0x54a6, 0x54a6, 0x54a6, 0x5d4e, 0x767c, 0x6591, 0x54a6, 0x54a6, 0x54a6, 0x5d70, 0x4553, 0x03e7, 0x03e6, 0x03e6, 0x0c28, 0x452a, 0x5526, 0x5526, 0x5526, 0x5526, 0x5546, 0x5d8d, 0x6e37, 0x769f, 0x76bf, 0x7e9d, 0x9670, 0xa665, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa665, 0x9e6a, 0x7e9a, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769d, 0x7e57, 0x7e56, 0x769d, 0x76bf, 
  0x76bf, 0x769c, 0x7dca, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7e12, 0x769f, 0x76bf, 0x7e57, 0x7da8, 0x8587, 0x8587, 0x85a7, 0xa646, 0xb684, 0xb684, 0xb684, 0xb684, 0xb686, 0x8e95, 0x76bf, 0x8e97, 0xb686, 0xae65, 0x8da6, 0x54a6, 0x54a6, 0x54a6, 0x54a6, 0x54a6, 0x54a6, 0x5d4e, 0x54e9, 0x54a6, 0x54a6, 0x4ca6, 0x1c69, 0x3d32, 0x03e6, 0x03e6, 0x03e6, 0x1447, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5547, 0x65d0, 0x769e, 0x8e71, 0xa646, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0x966e, 0x76bf, 0x76bf, 0x76bf, 0x767c, 0x7dcb, 0x85a7, 0x85a7, 0x7dcc, 0x769c, 
  0x769e, 0x7dee, 0x8587, 0x8587, 0x8587, 0x8587, 0x7da9, 0x7dcd, 0x7dcb, 0x85a7, 0x8587, 0x8587, 0x8587, 0x7da8, 0x7e59, 0x769e, 0x7dcb, 0x8587, 0x8587, 0x85a7, 0x9e26, 0xb685, 0xb685, 0xb684, 0xb684, 0xb684, 0xb684, 0xae89, 0x86bb, 0xae88, 0xb685, 0xb684, 0xb665, 0x9607, 0x6507, 0x54a6, 0x54a6, 0x54a6, 0x54a6, 0x54e9, 0x54e9, 0x54a6, 0x4c86, 0x1427, 0x0c29, 0x3d32, 0x03e6, 0x03e6, 0x0407, 0x44e7, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x6df1, 0xa666, 0xa645, 0xa645, 0xa645, 0xa645, 0xa666, 0xa665, 0xa645, 0xa645, 0xa645, 0x9e69, 0x76bf, 0x76bf, 0x76bf, 0x7e33, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7e35, 
  0x7e59, 0x85a8, 0x8587, 0x8587, 0x8587, 0x7dcc, 0x7e7b, 0x769e, 0x769d, 0x7e36, 0x7da8, 0x8587, 0x8587, 0x8587, 0x7def, 0x7e34, 0x8587, 0x8587, 0x85a7, 0x9e26, 0xb685, 0xa68c, 0xa68d, 0xb686, 0xb684, 0xb684, 0xb684, 0xb685, 0x9e90, 0xb685, 0xb684, 0xb685, 0x9e27, 0x7e35, 0x767a, 0x7617, 0x5d0a, 0x54a6, 0x54a6, 0x65b3, 0x54e9, 0x4ca6, 0x0c07, 0x03e7, 0x0c29, 0x3d32, 0x03e6, 0x03e7, 0x34a7, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x5526, 0x7dc7, 0xa645, 0xa645, 0xa645, 0xa666, 0x8697, 0x7e9b, 0x8697, 0x9e6b, 0xa645, 0xa666, 0x8e93, 0x76bf, 0x76bf, 0x76bf, 0x7e12, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7e32, 
  0x7e10, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7e58, 0x769f, 0x76bf, 0x76bf, 0x769f, 0x7e10, 0x8587, 0x8587, 0x8587, 0x7da9, 0x7da9, 0x8587, 0x8587, 0x9606, 0xb686, 0x8e96, 0x76bf, 0x76bf, 0x8e97, 0xb685, 0xb684, 0xb684, 0xb684, 0xb685, 0xb684, 0xb684, 0xa646, 0x85a7, 0x7e59, 0x769e, 0x769f, 0x769f, 0x6e17, 0x6e18, 0x769f, 0x4ce9, 0x1427, 0x03e6, 0x03e6, 0x0c29, 0x3d32, 0x03e6, 0x1c67, 0x5526, 0x5526, 0x5526, 0x5d8c, 0x6e16, 0x765a, 0x6e14, 0x5d6b, 0x5526, 0x5526, 0x5d46, 0x9626, 0xa645, 0xa645, 0xa645, 0xa646, 0x8698, 0x7ebe, 0x76bf, 0x76bf, 0x869a, 0x8699, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x7e58, 0x85a8, 0x8587, 0x8587, 0x85a9, 0x7e79, 
  0x85a9, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7e10, 0x7e11, 0x7e11, 0x7e11, 0x7e11, 0x7ded, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x85a7, 0x9607, 0xb665, 0xa68a, 0x76bf, 0x76bf, 0x76bf, 0x7ebe, 0xae88, 0xb684, 0xb684, 0xb684, 0xb684, 0xb685, 0xa646, 0x85a7, 0x8587, 0x85a8, 0x7dee, 0x7e56, 0x769f, 0x76bf, 0x76bf, 0x769f, 0x2cab, 0x03e7, 0x03e6, 0x03e6, 0x0c29, 0x3d32, 0x0407, 0x4d06, 0x5526, 0x5526, 0x65d0, 0x769e, 0x76bf, 0x76bf, 0x76bf, 0x767d, 0x5d8c, 0x5526, 0x6d86, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa666, 0x9e6c, 0x8e95, 0x7e9e, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x7e58, 0x7dee, 0x7dee, 0x7e58, 0x769f, 
  0x85a7, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x85a7, 0x9606, 0xb665, 0xb684, 0xa68c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0xa68b, 0xb684, 0xb684, 0xb684, 0xb686, 0x9e6c, 0x8dc7, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x7da9, 0x7e36, 0x769d, 0x769f, 0x4509, 0x34a8, 0x1427, 0x0407, 0x0c29, 0x3d52, 0x44e7, 0x5526, 0x5526, 0x5d47, 0x6e59, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x6e16, 0x5d46, 0x8e06, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa667, 0x8e94, 0x7e9d, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x85a7, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x85a7, 0x9e26, 0xb665, 0xb684, 0xb684, 0xa68c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0xa68b, 0xb684, 0xb684, 0xb684, 0xb686, 0x7e9c, 0x7dee, 0x85a7, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x75ac, 0x6e5c, 0x4509, 0x44c6, 0x3cc6, 0x34a7, 0x2ca9, 0x5dd3, 0x5526, 0x5526, 0x5526, 0x5d6a, 0x767c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x6e38, 0x75c7, 0xa645, 0xa645, 0xa645, 0xa666, 0xa665, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0xa645, 0x9e6b, 0x7e9b, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x85a7, 0x8587, 0x8587, 0x8587, 0x85a8, 0x85ec, 0x85ec, 0x85ec, 0x85ec, 0x85ec, 0x85ec, 0x85ec, 0x85ec, 0x85ed, 0x8654, 0xb686, 0xb684, 0xb684, 0xb684, 0xa68c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0xa68b, 0xb684, 0xb684, 0xb685, 0xa648, 0x76bf, 0x769f, 0x7e59, 0x7dcc, 0x7da8, 0x8587, 0x8587, 0x8587, 0x7d87, 0x5508, 0x4d4d, 0x4509, 0x44c6, 0x44c6, 0x44c6, 0x44e8, 0x5db3, 0x4d07, 0x5526, 0x5526, 0x5d48, 0x6e5a, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x7656, 0x9e46, 0xa645, 0xa645, 0xa665, 0x8e95, 0x8697, 0x9e6a, 0xa667, 0xa645, 0xa645, 0xa645, 0xa645, 0x9e46, 0x862d, 0x769f, 0x76bf, 0x76bf, 0x769f, 0x7e59, 0x7dcc, 0x7dcc, 0x7e58, 0x769f, 
  0x7dcb, 0x8587, 0x8587, 0x8587, 0x7da9, 0x767c, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x7e9e, 0xb686, 0xb684, 0xb684, 0xb684, 0xa68c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0xa68b, 0xb684, 0xb684, 0xae65, 0x85c8, 0x76bf, 0x76bf, 0x76bf, 0x769e, 0x7e7a, 0x7e34, 0x7da9, 0x8587, 0x6d48, 0x44c6, 0x44c6, 0x44c7, 0x44c6, 0x44c6, 0x44c6, 0x44e8, 0x5dd4, 0x44c6, 0x44c6, 0x44e6, 0x4d06, 0x5db1, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x964d, 0xa645, 0xa645, 0xa645, 0xa667, 0x8699, 0x76bf, 0x7e9e, 0x8699, 0x8e92, 0xa667, 0xa645, 0x9626, 0x8de6, 0x85e6, 0x7e7b, 0x76bf, 0x76bf, 0x7e58, 0x85a8, 0x8587, 0x8587, 0x7da9, 0x7e79, 
  0x7e12, 0x85a7, 0x8587, 0x8587, 0x8587, 0x7dee, 0x769d, 0x769e, 0x769f, 0x769f, 0x7e9e, 0x7e9c, 0x8698, 0x7e9d, 0x7e9e, 0xb686, 0xb684, 0xb684, 0xb684, 0xa68c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0xa68b, 0xb684, 0xb684, 0x9e06, 0x7da8, 0x7e12, 0x7dee, 0x7e57, 0x769e, 0x76bf, 0x76bf, 0x769d, 0x7d87, 0x4ce6, 0x44c6, 0x44c6, 0x44c6, 0x44c6, 0x44c6, 0x44c6, 0x44e8, 0x6e5a, 0x44e7, 0x44c6, 0x44c6, 0x44c6, 0x44c6, 0x556f, 0x6e7c, 0x767d, 0x6e5b, 0x7dec, 0xa645, 0xa645, 0xa645, 0xa645, 0xa646, 0x9e6d, 0x869a, 0x7e9e, 0x76bf, 0x76bf, 0x8699, 0x9627, 0x85c5, 0x85c5, 0x85c5, 0x7e77, 0x76bf, 0x76bf, 0x7e12, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7e12, 
  0x7e7b, 0x7da9, 0x8587, 0x8587, 0x8587, 0x8587, 0x85a9, 0x7ded, 0x7e10, 0x862f, 0xa66a, 0xb686, 0xb685, 0xae88, 0x8699, 0xb686, 0xb684, 0xb684, 0xb684, 0xa68c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0xa68b, 0xb684, 0xae65, 0x85a7, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7dcc, 0x7e12, 0x7e33, 0x7df0, 0x6547, 0x44c6, 0x44c6, 0x44c6, 0x44c7, 0x44c6, 0x44c6, 0x44c6, 0x44e8, 0x769e, 0x5590, 0x44c6, 0x44c6, 0x44c6, 0x44c6, 0x44c6, 0x44e8, 0x4509, 0x5d48, 0x8de7, 0x9606, 0x9e26, 0xa646, 0xa645, 0xa645, 0xa645, 0xa666, 0x9e6c, 0x8e92, 0x8e74, 0x862e, 0x85c6, 0x85c5, 0x85c5, 0x85c6, 0x7e7a, 0x76bf, 0x76bf, 0x7e33, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7e35, 
  0x769f, 0x7e33, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x85a7, 0x9607, 0xb665, 0xb685, 0xb684, 0xb684, 0xb685, 0x9694, 0xb686, 0xb684, 0xb684, 0xb684, 0xa68c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0xa68b, 0xb685, 0x8de8, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x7d87, 0x5507, 0x44c6, 0x44c6, 0x4509, 0x4d09, 0x44c6, 0x44c6, 0x44c6, 0x44e8, 0x769f, 0x769f, 0x4d2b, 0x44c6, 0x44c6, 0x44c6, 0x44c6, 0x44c6, 0x4ce7, 0x7d87, 0x8587, 0x8587, 0x8587, 0x85a7, 0x85c7, 0x9608, 0x9e46, 0xa645, 0xa645, 0xa645, 0x8e06, 0x85c5, 0x85c5, 0x85c5, 0x85c5, 0x85e9, 0x769f, 0x76bf, 0x76bf, 0x769c, 0x7da9, 0x8587, 0x8587, 0x7dcc, 0x769c, 
  0x76bf, 0x769e, 0x7e33, 0x85a9, 0x8587, 0x85a7, 0x95e6, 0xa646, 0xb665, 0xb684, 0xb684, 0xb684, 0xb685, 0xae87, 0x8699, 0xb687, 0xb685, 0xb684, 0xb684, 0x9e8e, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x9e8d, 0xae65, 0x85a7, 0x8587, 0x85a8, 0x85a7, 0x8587, 0x8587, 0x8587, 0x8587, 0x8587, 0x7d87, 0x44c6, 0x44c6, 0x44e8, 0x6638, 0x4d2b, 0x44c6, 0x44c6, 0x44c6, 0x4d0a, 0x769f, 0x76bf, 0x6e5b, 0x4d2c, 0x44c6, 0x44c6, 0x44c6, 0x5507, 0x7d87, 0x8587, 0x8587, 0x8587, 0x85a7, 0x7def, 0x7def, 0x85a7, 0x85a7, 0x85a7, 0x85a7, 0x7da8, 0x7587, 0x7da6, 0x7da6, 0x7da7, 0x85c8, 0x7e56, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769d, 0x7e56, 0x7e56, 0x769d, 0x76bf, 
  0x76bf, 0x76bf, 0x769f, 0x7e7a, 0x85ed, 0xae66, 0xb665, 0xb685, 0xb684, 0xb684, 0xb685, 0xb685, 0xae8a, 0x869b, 0x76bf, 0x8e96, 0xb685, 0xb685, 0xb686, 0x86b9, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x7e9b, 0x9e27, 0x85a7, 0x85a7, 0x7e56, 0x7e57, 0x7da9, 0x85a7, 0x8587, 0x8587, 0x7d87, 0x5507, 0x44c6, 0x44e8, 0x6618, 0x769f, 0x6618, 0x44c7, 0x44c6, 0x44c6, 0x6e3a, 0x76bf, 0x76bf, 0x76bf, 0x769e, 0x5db3, 0x44e7, 0x4ce7, 0x7d87, 0x8587, 0x8587, 0x8587, 0x7da9, 0x7e36, 0x769f, 0x769e, 0x7e12, 0x85a7, 0x7d87, 0x6d67, 0x6d46, 0x6d46, 0x6d46, 0x6d47, 0x6d48, 0x7636, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x869b, 0x8e95, 0x9692, 0x9691, 0x9692, 0x8e94, 0x8699, 0x7ebe, 0x76bf, 0x76bf, 0x76bf, 0x8699, 0x9694, 0x8699, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x7e7a, 0x7e35, 0x7e59, 0x769f, 0x769f, 0x769d, 0x7e57, 0x7e13, 0x7e11, 0x7e10, 0x5db1, 0x65f6, 0x767d, 0x769f, 0x76bf, 0x769f, 0x6638, 0x5dd4, 0x6e39, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x6e7c, 0x7637, 0x7e13, 0x7e11, 0x7e33, 0x7e57, 0x769d, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x7e7b, 0x7635, 0x6dd0, 0x6daf, 0x6daf, 0x6dd0, 0x7614, 0x767c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x769f, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x769e, 0x769e, 0x769f, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x769f, 0x769f, 0x769f, 0x76bf, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x76bf, 0x767e, 0x769f, 0x76bf, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x769f, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x5dd9, 0x5db9, 0x5d98, 0x6e5d, 0x65da, 0x6e5d, 0x767e, 0x6e3d, 0x767e, 0x6e5d, 0x6e3c, 0x5d98, 0x4d14, 0x5dda, 0x767e, 0x65fa, 0x44b2, 0x65fb, 0x769f, 0x769f, 0x65fb, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x769f, 0x5db9, 0x5556, 0x769f, 0x769f, 0x661b, 0x6e7e, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x5d98, 0x5556, 0x3c71, 0x3c50, 0x342e, 0x3c71, 0x44b2, 0x342f, 0x3c70, 0x44b2, 0x3c4f, 0x3c70, 0x238b, 0x3c91, 0x44d3, 0x5d98, 0x3c91, 0x3c4f, 0x44b3, 0x342f, 0x340e, 0x4cf4, 0x44d3, 0x3c70, 0x342f, 0x2bed, 0x3c4f, 0x661c, 0x5557, 0x4cf4, 0x33ed, 0x4491, 0x44b2, 0x6e3c, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 
  0x76bf, 0x6e5d, 0x4cf4, 0x5557, 0x5db9, 0x4d15, 0x5db9, 0x5557, 0x4cf4, 0x5d98, 0x65da, 0x4cd3, 0x5556, 0x4cf4, 0x4cf4, 0x5db9, 0x65fb, 0x4cf4, 0x5536, 0x65da, 0x4cf4, 0x4d15, 0x4cf4, 0x4d15, 0x3c50, 0x4cd3, 0x4cd3, 0x4d14, 0x6e3d, 0x5db9, 0x4d15, 0x4492, 0x4d15, 0x4d15, 0x6e3d, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf, 0x76bf
};



/////////////////////////////////////////////////////////////



LGFX lcd;
int16_t x, y;
int mode = 1;
int x_fleche = 0;
int y_fleche = 0;
float distance;



void dessin_ecran(){

  // Cadre de bas d'ecran
  if      (mode == 1) {lcd.fillRect(0, 401, 80, 81, lcd.color565(0, 174, 242)); lcd.fillRect(81, 401, 80, 81, lcd.color565(118, 212, 255));}
  else if (mode == 2) {lcd.fillRect(81, 401, 80, 81, lcd.color565(0, 174, 242)); lcd.fillRect(0, 401, 80, 81, lcd.color565(118, 212, 255));}
  lcd.drawRect(-1, 400, 82, 81, TFT_BLACK);
  lcd.drawRect(80, 400, 81, 81, TFT_BLACK);
  lcd.drawRect(160, 400, 161, 81, TFT_BLACK);

  // Croix du joystick virtuel
  lcd.drawLine(140, 20, 180, 20, TFT_BLACK);
  lcd.drawLine(140, 300, 180, 300, TFT_BLACK);
  lcd.drawLine(20, 140, 20, 180, TFT_BLACK);
  lcd.drawLine(300, 140, 300, 180, TFT_BLACK);
  lcd.drawLine(160, 20, 160, 300, TFT_BLACK);
  lcd.drawLine(20, 160, 300, 160, TFT_BLACK);
  lcd.fillCircle(160, 160, 22, lcd.color565(118, 212, 255));
  lcd.drawCircle(160, 160, 22, TFT_BLACK);

  // Credits
  lcd.setTextColor(TFT_BLACK, lcd.color565(118, 212, 255));
  lcd.drawString("Conception par :", 5, 378, 1);
  lcd.drawString("Nathanael DEBREILLY, Eliez LE HUNSEC, Ilan CHANY", 5, 388, 1);
  lcd.pushImage(235, 5, IMAGE_WIDTH, IMAGE_HEIGHT, image_data);

  // Affichage direction appui
  if (x_fleche != 0 && y_fleche != 0){
    lcd.drawLine(160, 160, x_fleche, y_fleche, TFT_RED);
    lcd.drawLine(160, 161, x_fleche, y_fleche+1, TFT_RED);
    lcd.fillRect(x_fleche-5, y_fleche-5, 10, 10, TFT_RED);
  }
}



void setup() {

  Serial.begin(115200);
  pinMode(45, OUTPUT);
  digitalWrite(45, HIGH);

  lcd.init();
  lcd.setRotation(2);
  lcd.setColorDepth(16);
  lcd.setSwapBytes(true);
  lcd.invertDisplay(true);
  lcd.initTouch();

  lcd.fillRect(0, 0, 320, 480, lcd.color565(118, 212, 255));
  dessin_ecran();
}

void loop() {

  if (lcd.getTouch(&x, &y)) { // Si ecran touche

    if (x <= 80 && y >= 400) mode = 1; // Si bouton mode 1
  
    else if (x >= 80 && x <= 160 && y >= 400) mode = 2; // Si bouton mode 2

    else if (y <= 320){

      distance = sqrt(pow(x - 160, 2) + pow(y - 160, 2));
      lcd.drawLine(160, 160, x_fleche, y_fleche, lcd.color565(118, 212, 255));
      lcd.drawLine(160, 161, x_fleche, y_fleche+1, lcd.color565(118, 212, 255));
      lcd.fillRect(x_fleche-5, y_fleche-5, 10, 10, lcd.color565(118, 212, 255));
      
      if (distance <= 22){
        x_fleche = 0;
        y_fleche = 0;
      }

      else if (x >= 150 && x <= 170){
        x_fleche = 160;
        y_fleche = y;
      }

      else if (y >= 150 && y <= 170){
        x_fleche = x;
        y_fleche = 160;
      }

      else {
        x_fleche = x;
        y_fleche = y;
      }

    }

    dessin_ecran();
  }

  delay(16);
}














